# Contributor: Jakub Jirutka <jakub@jirutka.cz>
# Maintainer: Jakub Jirutka <jakub@jirutka.cz>
pkgname=gitlab-workhorse
pkgver=6.1.0
pkgrel=1
pkgdesc="A reverse proxy for GitLab"
pkgusers="git"
url="https://gitlab.com/gitlab-org/gitlab-workhorse/"
arch="all"
license="MIT"
makedepends="go>=1.8"
source="https://gitlab.com/gitlab-org/$pkgname/-/archive/v$pkgver/$pkgname-v$pkgver.tar.gz
	workhorse.toml
	$pkgname.initd"
builddir="$srcdir/$pkgname-v$pkgver"
options="!check"

build() {
	cd "$builddir"

	make VERSION=$pkgver
}

package() {
	cd "$builddir"

	make install PREFIX="$pkgdir/usr"

	install -m644 -D "$srcdir"/workhorse.toml "$pkgdir"/etc/gitlab/workhorse.toml
	install -m755 -D "$srcdir"/$pkgname.initd "$pkgdir"/etc/init.d/gitlab.workhorse
}

sha512sums="083b0e8b055695195f4b17c9ed3ed2584b7c11fb18a2d348113d5ae6fd68353c0ecf4a1c2ba1e5b08dcd556eb073cb19cda8dd592d3afeaa0660e36a2e9db52b  gitlab-workhorse-v6.1.0.tar.gz
303847382fc973c92dd951ee43f7e06ecd3c7c6655752877cd2171e4c267a2dbbeed1faa45814d4bcc2a41a2a9f57d7a62366f0082612d50a5b935d9493ace52  workhorse.toml
42856444129f0034886f066f34cbc14e3960353026f03709e0bc9b015f65b8397a0b27873b567cb46be9c2045342f44f6e00ae6726f8e37a560fe46a5d8a019b  gitlab-workhorse.initd"
