From ac980c9327974a30c1536dccac2b94065cdc5122 Mon Sep 17 00:00:00 2001
From: Jakub Jirutka <jakub@jirutka.cz>
Date: Wed, 25 Jul 2018 20:25:25 +0200
Subject: [PATCH] Hotfix crash on MR page with comments on diffs of LFS files

Upstream-Issue: https://gitlab.com/gitlab-org/gitlab-ce/issues/43783
See-Also: https://gitlab.com/gitlab-org/gitlab-ce/merge_requests/16795/diffs#note_90362624
---
 app/models/concerns/discussion_on_diff.rb | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/app/models/concerns/discussion_on_diff.rb b/app/models/concerns/discussion_on_diff.rb
index 8b3c55387b3..a13c2e43ae8 100644
--- a/app/models/concerns/discussion_on_diff.rb
+++ b/app/models/concerns/discussion_on_diff.rb
@@ -37,7 +37,7 @@ module DiscussionOnDiff
 
   # Returns an array of at most 16 highlighted lines above a diff note
   def truncated_diff_lines(highlight: true)
-    return [] if diff_line.nil? && first_note.is_a?(LegacyDiffNote)
+    return [] if diff_line.nil?
 
     lines = highlight ? highlighted_diff_lines : diff_lines
 
-- 
2.16.4

