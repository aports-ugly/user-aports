# Contributor: Jakub Jirutka <jakub@jirutka.cz>
# Maintainer: Jakub Jirutka <jakub@jirutka.cz>
pkgname=suitesparse
_pkgname=SuiteSparse
pkgver=4.5.3
pkgrel=0
pkgdesc="A collection of sparse matrix libraries"
url="http://faculty.cse.tamu.edu/davis/suitesparse.html"
arch="x86 x86_64"
license="GPL"
depends_dev="openblas-dev"
makedepends="$depends_dev"
subpackages="$pkgname-dev $pkgname-doc"
source="http://faculty.cse.tamu.edu/davis/$_pkgname/$_pkgname-$pkgver.tar.gz
	0001-exclude-metis.patch
	0002-remove-rpath.patch
	"
builddir="$srcdir/$_pkgname"

prepare() {
	cd "$builddir"

	# OpenBLAS also provides LAPACK (?)
	export LAPACK="-lopenblas"

	# gcc fails on internal error when using default -O3.
	export OPTIMIZATION="-O2"

	# Do not include the Partition module and METIS (it's optional and
	# Julia doesn't need it).
	export CFLAGS="$CFLAGS -DNPARTITION"
	rm -r metis-*

	default_prepare
}

build() {
	cd "$builddir"

	make library
}

package() {
	cd "$builddir"

	make install \
		INSTALL="$pkgdir/usr" \
		INSTALL_INCLUDE="$pkgdir/usr/include/$pkgname" \
		INSTALL_DOC="$pkgdir/usr/share/doc/$pkgname"
}

md5sums="8ec57324585df3c6483ad7f556afccbd  SuiteSparse-4.5.3.tar.gz
500336d2933897e891f67d5f2af2b558  0001-exclude-metis.patch
9c4a2d7f5fcf67f792f435223a4a8c39  0002-remove-rpath.patch"
sha256sums="6199a3a35fbce82b155fd2349cf81d2b7cddaf0dac218c08cb172f9bc143f37a  SuiteSparse-4.5.3.tar.gz
19c66513197f9387e3e8ea056e61ce9c82f548a8bbc48c82ffd7466e5183ac9e  0001-exclude-metis.patch
a2dc6a7c3b0847b503c84391f83000412b8319efae840e9dd0d07d51a1f34f50  0002-remove-rpath.patch"
sha512sums="88a5ba6c70e4d66751d1ac32fd8998cde11509e7b034814c34757180db70ce2838ebb77fd7c617bf96e473214c70ccbdd0064b4f5e4dd69ae4c51dfeb9696496  SuiteSparse-4.5.3.tar.gz
503914c75b979add4c4b98889c7edec2e9dc493928f63bc0abe5cc4aa26bd5f81a9c1b38f708df3f1d8bc6890e8a3ffe72cda449a456c8d02dde2de150ccb04d  0001-exclude-metis.patch
ec0a0e6f4fd1f7184af1f8cd3cdb427b4b016b4fac035481ea4d063c020e36865d9dcd9985256394a8c5e3744510afa3fd61d96030f187cc3ef53e12f2228d21  0002-remove-rpath.patch"
