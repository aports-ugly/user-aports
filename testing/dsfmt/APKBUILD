# Contributor: Jakub Jirutka <jakub@jirutka.cz>
# Maintainer: Jakub Jirutka <jakub@jirutka.cz>
pkgname=dsfmt
_pkgname=dSFMT
pkgver=2.2.3
pkgrel=1
pkgdesc="Double precision SIMD-oriented Fast Mersenne Twister"
url="http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/SFMT/#dSFMT"
arch="all"
license="BSD"
depends=""
depends_dev="$pkgname"
makedepends=""
subpackages="$pkgname-dev"
source="http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/SFMT/$_pkgname-src-$pkgver.tar.gz
	0001-dSFMT.patch
	"
builddir="$srcdir/$_pkgname-src-$pkgver"

_soname="lib$_pkgname.so"

build() {
	cd "$builddir"

	# copied from https://github.com/JuliaLang/julia/blob/master/deps/dsfmt.mk
	CFLAGS="$CFLAGS -DNDEBUG -DDSFMT_MEXP=19937 -DDSFMT_DO_NOT_USE_OLD_NAMES
		-fPIC -O3 -finline-functions -fomit-frame-pointer
		-fno-strict-aliasing --param max-inline-insns-single=1800
		-Wmissing-prototypes -Wall -std=c99 -shared"

	if [ "$CARCH" = x86_64 ]; then
		CFLAGS="$CFLAGS -msse2 -DHAVE_SSE2"
	fi

	gcc $CFLAGS dSFMT.c -o $_soname
}

package() {
	cd "$builddir"

	install -D $_soname "$pkgdir"/usr/lib/$_soname || return 1
	install -D dSFMT.h "$pkgdir"/usr/include/dSFMT.h
}

md5sums="057c5a11d28296825fba584f561a4369  dSFMT-src-2.2.3.tar.gz
6f51118094264b7c283e3686db193afe  0001-dSFMT.patch"
sha256sums="82344874522f363bf93c960044b0a6b87b651c9565b6312cf8719bb8e4c26a0e  dSFMT-src-2.2.3.tar.gz
0128dbf6b3046182cbbf162468dcb4cb47f59655730e9bf9e33bcc29f376d47b  0001-dSFMT.patch"
sha512sums="6d8ddcd01aab3f9039f4f0288a8af53e290cc2f293ed8c4a8c9f3b3f12398e7eedfce8016117b425766ba89c61c86c13b3e420035b5f9bf91315b8b814c03662  dSFMT-src-2.2.3.tar.gz
2687a1de8ce49ff8dac4135932ea4cc95a3c6e9679ceaed922a678be63a163925beb955d3f6a638f339f9d1faefd6741ffbf1becac574ffcf540ee6fda63cdce  0001-dSFMT.patch"
